<div class="search-container">
  <!-- Search Bar -->
  <mat-card class="search-card">
    <mat-card-content>
      <mat-form-field class="search-field" appearance="outline">
        <mat-label>Search by Loan ID or Insurance Type</mat-label>
        <input 
          matInput 
          placeholder="Enter loan ID or insurance type..."
          [ngModel]="searchText()"
          (ngModelChange)="onSearchChange($event)">
        <mat-icon matPrefix>search</mat-icon>
        @if (searchText()) {
          <button 
            matSuffix 
            mat-icon-button 
            (click)="onSearchChange('')">
            <mat-icon>close</mat-icon>
          </button>
        }
      </mat-form-field>
    </mat-card-content>
  </mat-card>

  <!-- Table -->
  <mat-card class="table-card">
    @if (loading()) {
      <div class="loading-container">
        <mat-progress-spinner mode="indeterminate" color="primary"></mat-progress-spinner>
      </div>
    } @else {
      <div class="table-container">
        <table mat-table [dataSource]="displayedData()" class="data-table">
          
          <!-- ID Column -->
          <ng-container matColumnDef="id">
            <th mat-header-cell *matHeaderCellDef>ID</th>
            <td mat-cell *matCellDef="let item">{{ item.id }}</td>
          </ng-container>

          <!-- Loan ID Column -->
          <ng-container matColumnDef="loanId">
            <th mat-header-cell *matHeaderCellDef>Loan ID</th>
            <td mat-cell *matCellDef="let item">{{ item.loanId }}</td>
          </ng-container>

          <!-- Balance Column -->
          <ng-container matColumnDef="balance">
            <th mat-header-cell *matHeaderCellDef>Balance</th>
            <td mat-cell *matCellDef="let item">{{ formatCurrency(item.balance) }}</td>
          </ng-container>

          <!-- LTV Column -->
          <ng-container matColumnDef="ltv">
            <th mat-header-cell *matHeaderCellDef>LTV</th>
            <td mat-cell *matCellDef="let item">{{ formatPercentage(item.ltv) }}</td>
          </ng-container>

          <!-- Insurance Type Column -->
          <ng-container matColumnDef="insuranceType">
            <th mat-header-cell *matHeaderCellDef>Insurance Type</th>
            <td mat-cell *matCellDef="let item">
              <span class="insurance-badge" [class]="'insurance-' + (item.insuranceType || 'unknown').toLowerCase()">
                {{ item.insuranceType || 'N/A' }}
              </span>
            </td>
          </ng-container>

          <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
          <tr 
            mat-row 
            *matRowDef="let row; columns: displayedColumns;"
            class="clickable-row"
            (click)="onRowClick(row)">
          </tr>
        </table>

        <!-- Paginator -->
        <mat-paginator
          [length]="totalItems()"
          [pageSize]="pageSize()"
          [pageIndex]="pageIndex()"
          [pageSizeOptions]="[5, 10, 25, 50]"
          (page)="onPageChange($event)"
          showFirstLastButtons>
        </mat-paginator>
      </div>
    }
  </mat-card>

  <!-- Detail View Modal -->
  @if (selectedItem()) {
    <div class="detail-overlay" (click)="closeDetail()">
      <mat-card class="detail-card" (click)="$event.stopPropagation()">
        <mat-card-header>
          <mat-card-title>Loan Details</mat-card-title>
          <button mat-icon-button (click)="closeDetail()" class="close-btn">
            <mat-icon>close</mat-icon>
          </button>
        </mat-card-header>
        
        <mat-card-content>
          <div class="detail-row">
            <span class="detail-label">ID:</span>
            <span class="detail-value">{{ selectedItem()!.id }}</span>
          </div>
          <div class="detail-row">
            <span class="detail-label">Loan ID:</span>
            <span class="detail-value">{{ selectedItem()!.loanId }}</span>
          </div>
          <div class="detail-row">
            <span class="detail-label">Balance:</span>
            <span class="detail-value">{{ formatCurrency(selectedItem()!.balance) }}</span>
          </div>
          <div class="detail-row">
            <span class="detail-label">LTV:</span>
            <span class="detail-value">{{ formatPercentage(selectedItem()!.ltv) }}</span>
          </div>
          <div class="detail-row">
            <span class="detail-label">Insurance Type:</span>
            <span class="insurance-badge" [class]="'insurance-' + (selectedItem()!.insuranceType || 'unknown').toLowerCase()">
              {{ selectedItem()!.insuranceType || 'N/A' }}
            </span>
          </div>
        </mat-card-content>
      </mat-card>
    </div>
  }
</div>